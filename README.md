# Aris Blog - ç°ä»£åŒ–åšå®¢ç½‘ç«™

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Next.js 16+ æ„å»ºçš„ç°ä»£åŒ–åšå®¢ç½‘ç«™å‰ç«¯é¡¹ç›®ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ” **OAuth2 ç™»å½•** - æ”¯æŒ GitHub ç­‰ç¬¬ä¸‰æ–¹ç™»å½•
- ğŸ‘¤ **ç”¨æˆ·ä¿¡æ¯å±•ç¤º** - Header æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œä¿¡æ¯ï¼Œæ‚¬åœæ˜¾ç¤ºè¯¦ç»†å¡ç‰‡
- ğŸ“ **æ–‡ç« åˆ—è¡¨** - æ— é™æ»šåŠ¨ç€‘å¸ƒæµï¼Œå®æ—¶æœç´¢
- ğŸ·ï¸ **æ ‡ç­¾ç³»ç»Ÿ** - ç‹¬ç«‹æ»šåŠ¨çš„æ ‡ç­¾åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢
- ğŸ¨ **ç°ä»£åŒ– UI** - ä½¿ç”¨ Shadcn UIï¼Œæµç•…çš„è¿‡æ¸¡åŠ¨ç”»
- ğŸ“± **å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 16 (App Router)
- **è¯­è¨€**: TypeScript
- **UI æ¡†æ¶**: Tailwind CSS v4
- **ç»„ä»¶åº“**: Shadcn UI (Neutral ä¸»é¢˜)
- **æ„å»ºå·¥å…·**: Turbopack
- **API å®¢æˆ·ç«¯**: Axios + Orval (è‡ªåŠ¨ç”Ÿæˆ)
- **è®¤è¯**: OAuth2
- **åç«¯ API**: å¯é…ç½®ï¼ˆé»˜è®¤ https://s.lvlvko.topï¼‰

## é¡¹ç›®ç»“æ„

```
web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # API ç›¸å…³æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ endpoints/          # API è°ƒç”¨å‡½æ•°ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/             # AI ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ article/        # æ–‡ç« ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ article-version/# æ–‡ç« ç‰ˆæœ¬æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ comment/        # è¯„è®ºç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth2/         # OAuth2 è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ tag/            # æ ‡ç­¾ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ user/           # ç”¨æˆ·ç›¸å…³æ¥å£
â”‚   â”‚   â”œâ”€â”€ models/             # TypeScript ç±»å‹å®šä¹‰ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ mutator/            # Axios å®ä¾‹é…ç½®ï¼ˆå¸¦è®¤è¯æ‹¦æˆªå™¨ï¼‰
â”‚   â”‚   â””â”€â”€ index.ts            # API ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (main)/             # ä¸»åº”ç”¨å¸ƒå±€ï¼ˆéœ€ç™»å½•ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx      # åŒ…å« UserHeader çš„å¸ƒå±€
â”‚   â”‚   â”‚   â””â”€â”€ home/           # ä¸»é¡µï¼ˆæ–‡ç« å’Œæ ‡ç­¾åˆ—è¡¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ callback/       # OAuth2 å›è°ƒå¤„ç†
â”‚   â”‚   â”œâ”€â”€ login/              # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ page.tsx            # æ ¹è·¯ç”±ï¼ˆè‡ªåŠ¨è·³è½¬ï¼‰
â”‚   â”œâ”€â”€ components/             # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/                 # Shadcn UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ user-header.tsx     # ç”¨æˆ·ä¿¡æ¯ Header
â”‚   â”‚   â”œâ”€â”€ article-list.tsx    # æ–‡ç« åˆ—è¡¨ï¼ˆæ— é™æ»šåŠ¨ï¼‰
â”‚   â”‚   â””â”€â”€ tag-list.tsx        # æ ‡ç­¾åˆ—è¡¨ï¼ˆæ— é™æ»šåŠ¨ï¼‰
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ env.ts              # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé›†ä¸­ç®¡ç†ï¼‰
â”‚   â””â”€â”€ lib/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ utils.ts            # é€šç”¨å·¥å…·
â”‚       â””â”€â”€ auth.ts             # è®¤è¯ç›¸å…³å·¥å…·
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ env.example                 # ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
â”œâ”€â”€ orval.config.ts             # Orval é…ç½®æ–‡ä»¶
â”œâ”€â”€ components.json             # Shadcn UI é…ç½®
â””â”€â”€ package.json
```

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š

```bash
cp env.example .env.local
```

ç¼–è¾‘ `.env.local` æ–‡ä»¶ï¼Œé…ç½®åç«¯ API åœ°å€ï¼š

```bash
# åç«¯ API åŸºç¡€åœ°å€
NEXT_PUBLIC_API_BASE_URL=https://s.lvlvko.top

# å‰ç«¯åº”ç”¨åœ°å€ï¼ˆç”¨äº OAuth å›è°ƒï¼‰
NEXT_PUBLIC_APP_URL=http://localhost:3000

# OpenAPI è§„èŒƒåœ°å€ï¼ˆç”¨äºä»£ç ç”Ÿæˆï¼‰
OPENAPI_URL=https://s.lvlvko.top/openapi.yaml
```

> **æ³¨æ„**ï¼šå¦‚æœä¸é…ç½® `.env.local`ï¼Œåº”ç”¨ä¼šä½¿ç”¨é»˜è®¤å€¼ `https://s.lvlvko.top`

### 2. å®‰è£…ä¾èµ–

```bash
cd /root/code/aris-blog/web
npm install
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000

é¦–æ¬¡è®¿é—®ä¼šè·³è½¬åˆ°ç™»å½•é¡µï¼Œé€‰æ‹© GitHub ç™»å½•å³å¯å¼€å§‹ä½¿ç”¨ã€‚

### 5. é‡æ–°ç”Ÿæˆ API ä»£ç ï¼ˆå¯é€‰ï¼‰

å½“åç«¯ API æœ‰æ›´æ–°æ—¶ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆ API ä»£ç ï¼š

```bash
npm run generate:api
```

> **æç¤º**ï¼šç”Ÿæˆ API ä»£ç æ—¶ä¼šä½¿ç”¨ `.env.local` ä¸­é…ç½®çš„ `OPENAPI_URL`

## é¡µé¢è¯´æ˜

### ç™»å½•é¡µ (`/login`)
- OAuth2 è®¤è¯å…¥å£
- æ”¯æŒ GitHub ç­‰ç¬¬ä¸‰æ–¹ç™»å½•
- å·²ç™»å½•ç”¨æˆ·è‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µ

### ä¸»é¡µ (`/home`)
- **ç”¨æˆ· Header**: é¡¶éƒ¨æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œç”¨æˆ·åï¼Œæ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯å¡ç‰‡
- **æ–‡ç« åˆ—è¡¨**: å·¦ä¾§ 3/4 å®½åº¦
  - æ— é™æ»šåŠ¨åŠ è½½
  - å®æ—¶æœç´¢
  - æ˜¾ç¤ºæ–‡ç« æ ‡é¢˜ã€æè¿°ã€ä½œè€…ã€æ—¥æœŸã€é˜…è¯»æ•°ã€ç‚¹èµæ•°
  - ç‚¹å‡»å¡ç‰‡å¯æŸ¥çœ‹æ–‡ç« è¯¦æƒ…
- **æ ‡ç­¾åˆ—è¡¨**: å³ä¾§ 1/4 å®½åº¦
  - ç‹¬ç«‹æ»šåŠ¨åŒºåŸŸ
  - å®æ—¶æœç´¢
  - æ˜¾ç¤ºæ ‡ç­¾åç§°ã€æè¿°ã€æ–‡ç« æ•°é‡
  - ç‚¹å‡»æ ‡ç­¾å¯ç­›é€‰ç›¸å…³æ–‡ç« 

### OAuth2 å›è°ƒ (`/auth/callback`)
- å¤„ç†ç¬¬ä¸‰æ–¹ç™»å½•å›è°ƒ
- è‡ªåŠ¨ä¿å­˜è®¤è¯ Token
- è·å–å¹¶ä¿å­˜ç”¨æˆ·ä¿¡æ¯

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. OAuth2 è®¤è¯

ç³»ç»Ÿä½¿ç”¨ OAuth2 è¿›è¡Œç”¨æˆ·è®¤è¯ï¼ŒToken è‡ªåŠ¨ç®¡ç†ï¼š

```typescript
// ç™»å½•æµç¨‹ï¼ˆåœ¨ login/page.tsx ä¸­ï¼‰
import { getOAuth2LoginUrl } from '@/lib/auth';

const loginUrl = getOAuth2LoginUrl('github');
window.location.href = loginUrl;

// Token ä¼šåœ¨å›è°ƒåè‡ªåŠ¨ä¿å­˜
// Axios è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ Authorization header
```

### 2. API è°ƒç”¨ï¼ˆå¸¦è®¤è¯ï¼‰

æ‰€æœ‰ API è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨æºå¸¦è®¤è¯ Tokenï¼š

```typescript
import { listArticles, getCurrentUser } from '@/api';

// è·å–æ–‡ç« åˆ—è¡¨ï¼ˆè‡ªåŠ¨å¸¦ Tokenï¼‰
const articles = await listArticles({
  page: 1,
  page_size: 10,
  search: 'æœç´¢å…³é”®è¯',
});

// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
const user = await getCurrentUser();
```

### 3. æ— é™æ»šåŠ¨å®ç°

ä½¿ç”¨ Intersection Observer API å®ç°æ— é™æ»šåŠ¨ï¼š

```typescript
// åœ¨ article-list.tsx å’Œ tag-list.tsx ä¸­
const observer = new IntersectionObserver(
  (entries) => {
    if (entries[0].isIntersecting && hasMore && !loading) {
      setPage((prev) => prev + 1);
    }
  },
  { threshold: 0.1 }
);
```

### 4. æœç´¢é˜²æŠ–

æœç´¢è¾“å…¥ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æ€§èƒ½ï¼š

```typescript
// 500ms é˜²æŠ–
useEffect(() => {
  const timer = setTimeout(() => {
    setDebouncedSearch(searchQuery);
    setPage(1);
    setArticles([]);
  }, 500);
  return () => clearTimeout(timer);
}, [searchQuery]);
```

## å¯ç”¨çš„è„šæœ¬å‘½ä»¤

- `npm run dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆä½¿ç”¨ Turbopackï¼‰
- `npm run build` - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- `npm run start` - å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `npm run lint` - è¿è¡Œ ESLint
- `npm run generate:api` - é‡æ–°ç”Ÿæˆ API ä»£ç 

## Shadcn UI ç»„ä»¶

æ·»åŠ æ–°çš„ UI ç»„ä»¶ï¼š

```bash
npx shadcn@latest add button
npx shadcn@latest add card
npx shadcn@latest add dialog
# ... æ›´å¤šç»„ä»¶
```

æŸ¥çœ‹å¯ç”¨ç»„ä»¶ï¼šhttps://ui.shadcn.com

## ç¯å¢ƒé…ç½®

é¡¹ç›®ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒåç«¯ APIï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å¦‚éœ€ä¿®æ”¹ API åœ°å€ï¼Œè¯·ç¼–è¾‘ï¼š

- `orval.config.ts` - Orval é…ç½®
- `src/api/mutator/custom-instance.ts` - Axios å®ä¾‹é…ç½®

## æ³¨æ„äº‹é¡¹

1. **API ä»£ç è‡ªåŠ¨ç”Ÿæˆ**: `src/api/` ç›®å½•ä¸‹çš„ä»£ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹
2. **è®¤è¯æ‹¦æˆªå™¨**: Token ç®¡ç†å’Œåˆ·æ–°é€»è¾‘åœ¨ `src/api/mutator/custom-instance.ts` ä¸­å®ç°
3. **è·¯ç”±ä¿æŠ¤**: ä¸»åº”ç”¨éœ€è¦ç™»å½•æ€ï¼Œæœªç™»å½•ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
4. **Turbopack**: ä½¿ç”¨ Turbopack è·å¾—æ›´å¿«çš„å¼€å‘ä½“éªŒ
5. **Shadcn UI**: æ‰€æœ‰ç»„ä»¶ä¼˜å…ˆä½¿ç”¨ Shadcn UIï¼Œä¿æŒè®¾è®¡ç»Ÿä¸€

## å¼€å‘å»ºè®®

### æ·»åŠ æ–°é¡µé¢
1. éœ€è¦ç™»å½•çš„é¡µé¢æ”¾åœ¨ `app/(main)/` ç›®å½•ä¸‹
2. å…¬å¼€é¡µé¢æ”¾åœ¨ `app/` æ ¹ç›®å½•ä¸‹

### æ·»åŠ æ–°ç»„ä»¶
```bash
# æ·»åŠ  Shadcn UI ç»„ä»¶
npx shadcn@latest add [component-name]

# ä¾‹å¦‚ï¼šæ·»åŠ  Dialog ç»„ä»¶
npx shadcn@latest add dialog
```

### è‡ªå®šä¹‰æ ·å¼
é¡¹ç›®ä½¿ç”¨ Tailwind CSS v4ï¼Œå¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Tailwind ç±»åã€‚
å…¨å±€æ ·å¼åœ¨ `app/globals.css` ä¸­å®šä¹‰ã€‚

### Token åˆ·æ–°æœºåˆ¶
- Token è¿‡æœŸæ—¶ä¼šè‡ªåŠ¨å°è¯•åˆ·æ–°
- åˆ·æ–°å¤±è´¥ä¼šæ¸…é™¤è®¤è¯ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
- æ— éœ€æ‰‹åŠ¨å¤„ç† Token åˆ·æ–°é€»è¾‘

## åç«¯ API æ–‡æ¡£

- API Endpoint: https://s.lvlvko.top
- OpenAPI è§„èŒƒ: https://s.lvlvko.top/openapi.yaml

## License

MIT
